<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.15.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Project Lada: Project-Lada</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Project Lada
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.15.0 -->
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search',true);
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('md__r_e_a_d_m_e.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Project-Lada </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md0"></a></p>
<p>AVR Vehicle System</p>
<p>This is project was created for purposes of Digital Electronics 2 course at Brno University of Technology</p>
<p>The goal is to create a retrofit system for Lada 1300 that will give it more modern awareness and assistive capabilities.</p>
<p>The main features contain:</p><ol type="1">
<li>Rear (and optionally front) parking sensor system</li>
<li>Water and oil temperature readings</li>
<li>RPM and Speed readings</li>
</ol>
<p>Optional ambitious features are:</p><ol type="1">
<li>gear indicator with shifting suggestions</li>
<li>Auto-trigger of parking systems when put into reverse</li>
<li>Fuel readout with low level alert</li>
</ol>
<p>List of parts:</p><ul>
<li>Atmega 328P microcontroller on an UNO R3 board</li>
<li>HC-SR04 ultrasonic sensor (weather sealed) - 4 pcs</li>
<li>SSH1106 128 x 64 OLED i2c display (SH1106 tested)</li>
<li>KY-040 rotary encoder with button</li>
<li>Regin TG-AH4/PT1000 Thermal sensor (passive) - 2 pcs</li>
<li>Hall's sensor module 3144 driven by AZ393M (Digital mode)</li>
<li>Wiring (jumpwires, USB cable, breadboard...)</li>
</ul>
<h2 class="doxsection"><a class="anchor" id="autotoc_md1"></a>
Circuit diagram of the system</h2>
<p><img src="https://github.com/user-attachments/assets/01651812-494b-4f4f-b388-f2ae32adcc0d" alt="Project_Lada circuit" width="2475" height="1663" class="inline"/></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Software description</h1>
<p>When initialized, the arduino displays the default page, which shows the RPM of the vehicle. Pages can be switched via a rotary encoder, each turn (clockwise and counterclockwise) switches between pages: <b>RPM</b>, <b>temperature measurements</b>, <b>speed measurements</b>. When the rotary encoder is pressed, the <b>parking sensors</b> page are accessed.</p>
<p><b>Parking sensors</b> page dispays distance of obstacles from the 4 sensors and triggers a camera feed on a standalone infotainment. Sensors measure time that it takes for the ultrasonic sound wave to bounce back and return from an obstacle. From that, we calculate the distance. We then send this converted distance value to an OLED display. The camera feed is triggered and disabled over UART.</p>
<p><b>RPM</b> page displays the engine evolutions. When the revs rach a redline threshold, red LEDs light up. When it exceeds the redline, the LEDs blink. Information about the RPMs is obtained through ADC by measuring the difference between the alternator voltage output and that of a distributor.</p>
<p><b>Temperature</b> page displays the oil and coolant temperatures obtained and calculated through ADC from passive thermal sensors. When the temperature exceedes a healthy value, a corresponding LED lights up.</p>
<p><b>Speed measurement</b> uses the digital output of Hallâ€˜s probe. By passing a magnet near the probe, it measures the changes in the near magnetic field, and when its at its maximum value, it triggers a threshold and sends out a simple signal, which frequency is then valued as a speed measurement and displayed on the screen.</p>
<h2 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
Flowchart of the software operation</h2>
<p><img src="https://github.com/user-attachments/assets/c87b9b1c-ebaf-4c07-b1e1-f1dc4a48dd3c" alt="AVR Project flowchart" width="717" height="1672" class="inline"/></p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md4"></a>
Modules</h1>
<h1 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Parking system</h1>
<p>Parking system is a welcomed feature in any car. This goes particulary handy for vintage cars, because the outside visibility is also often very limited. For example, Lada 1300 has only a left mirror.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md6"></a>
Module function description</h1>
<p>Subsystem is summoned when</p><ul>
<li>parking system button is pressed (rotary encoder button)</li>
</ul>
<p>At first, parking subsystem initializes</p><ul>
<li>sets all it's flag variables accordingly (sensor triggering, page indexes etc)</li>
<li>sends camera initializing instruction over uart</li>
</ul>
<p>Parking subsystem then runs</p><ul>
<li>periodically using 16 us timer 0 measures distance (4 ultrasonic sensors evenly spaced out) one by one</li>
<li>distances are periodically drawn on display in a diagram form</li>
<li>camera feed is displayed on a separate infotainment (instructed via UART)</li>
</ul>
<p>Subystem turns off when</p><ul>
<li>parking system button is pressed again</li>
</ul>
<p>When subsystem turns off</p><ul>
<li>sensor reading are disabled</li>
<li>instruction to disable the camera is sent via uart</li>
<li>entire system returns to the last used page (before the parking subsystem was summoned)</li>
</ul>
<p>Hardware solution Sensors For demonstration, the project utilizes basic HC-SR04 ultrasonic sensors. For practical use, a weather sealed IP rated version of the HC ultrasonic sensors would be used.</p>
<p>Camera Since image decoding and processing uses a lot more processing power than that of an Atmega328p microcontroller, a Raspberry Pi board would be used to decode the image and simultaneously to run the standalone infotainment. At least an HD resolution camera with decent low light capabilities would be used. For demonstration purposes, the initializing camera signal is being sent via UART to another Arduino.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
Water and Oil temperature</h1>
<p>This particular car model doesn't have a reliable oil temperature readings and water temperature doesn't seem to be precise. Old carburetor cars are prone to overheating, especialy those from the eastern block. Temperature monitoring is then crucial for the car health and the owners wallets.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Module function description</h1>
<p>Subsystem is summoned when</p><ul>
<li>it's corresponding index is dialed with the rotary encoder</li>
</ul>
<p>At first, the temperature subsystem</p><ul>
<li>sets all it's flag variables accordingly (indexes, pages flag etc...)</li>
</ul>
<p>Temperature subsystem runs</p><ul>
<li>it periodically reads voltage on 2 channels using ADC and 262 ms timer 1</li>
<li>calculates temperature from the ADC reading<ul>
<li>it first converts raw ADC result to voltage</li>
<li>from the known components of the voltage divider, it calculates resistance</li>
<li>using equations corresponding to the specific sensor (Pt1000, Ni1000, 10k Thermistor etc.), it calculates temperature</li>
</ul>
</li>
<li>shows the temperature readings on the display</li>
</ul>
<p>Sybsystem turns off when</p><ul>
<li>it's index is no longer selected (different page is selected)</li>
</ul>
<p>When subsystem turns off</p><ul>
<li>sensor readings are disabled</li>
</ul>
<p>Hardware solution For both practical and demonstration purposes, the system uses Pt1000 sensors read by the Arduino's AD converter.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
RPM readings</h1>
<p>Lada 1300 misses a tachometer and uses only a speed gauge. Retrofiting it with a digital system will ensure optimal shifting timing and prevent overreving the engine.</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
Module function description</h1>
<p>Subsystem is summoned when</p><ul>
<li>it's corresponding index is dialed with the rotary encoder</li>
</ul>
<p>At first, the RPM subsystem</p><ul>
<li>sets all it's flag variables accordingly (pages, indexes...)</li>
</ul>
<p>RPM subsystem runs</p><ul>
<li>it periodically reads voltage from 1 ADC channel using 262 ms timer 1</li>
<li>it converts the voltage value to RPM using an equation<ul>
<li>voltage change corresponds to RPM change</li>
</ul>
</li>
<li>if the RPMs exceed a redline value, an LED lights up and if the engine is overreved, the LED blinks</li>
<li>it displays the RPM value</li>
</ul>
<p>Subsystem turns off when</p><ul>
<li>it's index is no longer selected (different page is selected)</li>
</ul>
<p>When subsystem turns off</p><ul>
<li>ADC readings are disabled</li>
</ul>
<p>Hardware solution reading the voltage difference between the alternator and ditributor or halls/optical switch</p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Speed measurement</h1>
<p>Knowing the speed at which you're driving is crucial to have in any vehicle, for safety, awareness and many other reasons. </p>
<h1 class="doxsection"><a class="anchor" id="autotoc_md12"></a>
Module function description</h1>
<p>Subsystem is summoned when</p><ul>
<li>it's corresponding index is dialed with the rotary encoder</li>
</ul>
<p>At first, the speed subsystem</p><ul>
<li>sets all it's flag variables accordingly (pages, indexes...)</li>
</ul>
<p>Speed subsystem runs</p><ul>
<li>it counts the switching of the hall's sensor every 2s (using 262 ms timer1 and a simple counter) and, based on that, calculates the speed value</li>
<li>it displays the speed value</li>
</ul>
<p>Subsystem turns off when</p><ul>
<li>it's index is no longer selected (different page is selected)</li>
</ul>
<p>When subsystem turns off</p><ul>
<li>the sensor readings are disabled</li>
</ul>
<p>Hardware solution</p><ul>
<li>Hall's switch triggered by a magnet, that is attached to a wheel. Speed is measured by the frequency of passings. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.15.0 </li>
  </ul>
</div>
</body>
</html>
